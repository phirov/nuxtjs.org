<!DOCTYPE html><html n-head=""n-head-ssr><meta n-head="true"charset="utf-8"><meta n-head="true"content="width=device-width,initial-scale=1"name="viewport"><meta n-head="true"content="Authenticated routes example with Nuxt.js"name="description"hid="description"><title n-head="true">Auth Routes - Nuxt.js Examples</title><link href="favicon.ico"rel="icon"n-head="true"type="image/x-icon"><base href="/"><link href="/_nuxt/style.css"rel="stylesheet"><body n-head=""><div id="__nuxt"server-rendered="true"><div data-v-cc2bcbd4><header class="Header"data-v-6fcc5ae1 data-v-cc2bcbd4><div class="container"data-v-6fcc5ae1><a href="/"class="nuxt-link-active Header__Title"data-v-6fcc5ae1><img alt="Logo nuxt"class="Header__Title__Logo Header__Title__Logo--desktop"data-v-6fcc5ae1 src="/_nuxt/img/logo_nav.png?be08efae0d5c46fd682e2a24f18545ae"><img alt="Logo nuxt"class="Header__Title__Logo Header__Title__Logo--mobile"data-v-6fcc5ae1 src="/_nuxt/img/logo_nav_mobile.png?f90e5a3d77508106e815f7179a322c02"><h1 class="Header__Title__Text"data-v-6fcc5ae1>NUXT</h1></a><nav class="Header__Nav Header__Nav--hidden"data-v-6fcc5ae1><div class="Header__Nav__Search Header__Nav__Search--mobile"data-v-6fcc5ae1><div class="Search"data-v-6fcc5ae1 data-v-60d64f08><input class="Search__Input"data-v-60d64f08 id="mobile"name="search"placeholder="Search"><label class="Search__Label"data-v-60d64f08 for="mobile"><div class="icon search"data-v-60d64f08></div></label></div></div><div class="Header__Nav__Lang"data-v-6fcc5ae1><img alt="en"class="Header__Nav__Lang__Img"data-v-6fcc5ae1 src="/flags/en.png"></div><ul class="Header__Nav__List"data-v-6fcc5ae1><li class="Header__Nav__List__Item"data-v-6fcc5ae1><a href="/guide"class="Header__Nav__List__Item__Link"data-v-6fcc5ae1>Guide</a><li class="Header__Nav__List__Item"data-v-6fcc5ae1><a href="/api"class="Header__Nav__List__Item__Link"data-v-6fcc5ae1>API</a><li class="Header__Nav__List__Item"data-v-6fcc5ae1><a href="/examples"class="Header__Nav__List__Item__Link nuxt-link-active"data-v-6fcc5ae1>Examples</a><li class="Header__Nav__List__Item"data-v-6fcc5ae1><div class="Header__Nav__List__Item__Link Dropdown"data-v-6fcc5ae1 data-v-38c38936><div class="Dropdown__Title"data-v-38c38936>Ecosystem</div><ul class="Dropdown__List"data-v-38c38936><li class="Dropdown__List__Item"data-v-38c38936><a href="https://github.com/nuxt"class="Dropdown__List__Item__Link"target="_blank"data-v-38c38936>Github</a><li class="Dropdown__List__Item"data-v-38c38936><a href="https://twitter.com/nuxt_js"class="Dropdown__List__Item__Link"target="_blank"data-v-38c38936>Twitter</a><li class="Dropdown__List__Item"data-v-38c38936><a href="https://medium.com/@nuxt_js"class="Dropdown__List__Item__Link"target="_blank"data-v-38c38936>Blog</a><li class="Dropdown__List__Item"data-v-38c38936><a href="https://gitter.im/nuxt/nuxt.js"class="Dropdown__List__Item__Link"target="_blank"data-v-38c38936>Chat</a><li class="Dropdown__List__Item"data-v-38c38936><a href="https://vuejs.org"class="Dropdown__List__Item__Link"target="_blank"data-v-38c38936>Vue.js</a><li class="Dropdown__List__Item"data-v-38c38936><a href="https://vuejobs.com/?ref=nuxtjs"class="Dropdown__List__Item__Link"target="_blank"data-v-38c38936>Vue Jobs</a></ul></div></ul><div class="Header__Nav__Search Header__Nav__Search--desktop"data-v-6fcc5ae1><div class="Search"data-v-6fcc5ae1 data-v-60d64f08><input class="Search__Input"data-v-60d64f08 id="desktop"name="search"placeholder="Search"><label class="Search__Label"data-v-60d64f08 for="desktop"><div class="icon search"data-v-60d64f08></div></label></div></div></nav><div class="Header__Toggler"data-v-6fcc5ae1><div class="icon menu"data-v-6fcc5ae1></div></div></div></header><div data-v-cc2bcbd4><div data-v-cc2bcbd4><div class="progress"data-v-2aeb4e08 style="width:0;height:2px;background-color:#41B883;opacity:0"></div><div class="category"><nav class="Affix Affix--hidden"data-v-0437d0ac><div class="Affix__Toggler"data-v-0437d0ac><div class="icon more-vertical"data-v-0437d0ac></div></div><h2 class="Affix__Version"data-v-0437d0ac>Version 0.9.5<div class="Affix__Version__Toggler"data-v-0437d0ac><div class="icon close"data-v-0437d0ac></div></div></h2><h3 class="Affix__Title"data-v-0437d0ac>Essentials</h3><ul class="Affix__List"data-v-0437d0ac><li class="Affix__List__Item"data-v-0437d0ac><a href="/examples"class="Affix__List__Item__Link"data-v-0437d0ac>Hello world</a><!----><li class="Affix__List__Item"data-v-0437d0ac><a href="/examples/seo-html-head"class="Affix__List__Item__Link"data-v-0437d0ac>SEO HTML Head</a><!----></ul><h3 class="Affix__Title"data-v-0437d0ac>Customization</h3><ul class="Affix__List"data-v-0437d0ac><li class="Affix__List__Item"data-v-0437d0ac><a href="/examples/cached-components"class="Affix__List__Item__Link"data-v-0437d0ac>Cached Components</a><!----><li class="Affix__List__Item"data-v-0437d0ac><a href="/examples/custom-loading"class="Affix__List__Item__Link"data-v-0437d0ac>Custom Loading</a><!----><li class="Affix__List__Item"data-v-0437d0ac><a href="/examples/custom-routes"class="Affix__List__Item__Link"data-v-0437d0ac>Custom Routes</a><!----><li class="Affix__List__Item"data-v-0437d0ac><a href="/examples/global-css"class="Affix__List__Item__Link"data-v-0437d0ac>Global CSS</a><!----><li class="Affix__List__Item"data-v-0437d0ac><a href="/examples/layouts"class="Affix__List__Item__Link"data-v-0437d0ac>Layouts</a><!----><li class="Affix__List__Item"data-v-0437d0ac><a href="/examples/plugins"class="Affix__List__Item__Link"data-v-0437d0ac>Plugins</a><!----><li class="Affix__List__Item"data-v-0437d0ac><a href="/examples/routes-transitions"class="Affix__List__Item__Link"data-v-0437d0ac>Routes transitions</a><!----></ul><h3 class="Affix__Title"data-v-0437d0ac>Advanced</h3><ul class="Affix__List"data-v-0437d0ac><li class="Affix__List__Item"data-v-0437d0ac><a href="/examples/async-datas"class="Affix__List__Item__Link"data-v-0437d0ac>Async Datas</a><!----><li class="Affix__List__Item"data-v-0437d0ac><a href="/examples/auth-routes"class="Affix__List__Item__Link nuxt-link-active nuxt-link-active"data-v-0437d0ac>Auth Routes</a><ul class="Affix__List__Item__Contents"data-v-0437d0ac></ul><li class="Affix__List__Item"data-v-0437d0ac><a href="/examples/vuex-store"class="Affix__List__Item__Link"data-v-0437d0ac>Vuex Store</a><!----><li class="Affix__List__Item"data-v-0437d0ac><a href="/examples/testing"class="Affix__List__Item__Link"data-v-0437d0ac>Testing</a><!----></ul></nav><div class="category__content"><div class="Content"data-v-15f50eb8><h1 data-v-15f50eb8>Auth Routes</h1><blockquote data-v-15f50eb8><p data-v-15f50eb8>Authenticated routes example with Nuxt.js</blockquote><!----><h2 data-v-15f50eb8>Source Code</h2><div class="FilesTree clearfix"data-v-df2e5dde data-v-15f50eb8><div class="FilesTree__Left"data-v-df2e5dde><div class="FilesTree__Left__Header"data-v-df2e5dde><div class="Icon"data-v-df2e5dde><div class="icon remove"data-v-df2e5dde></div></div>Example Files</div><div class="FilesTree__Left__Body"data-v-df2e5dde><ul class="RecursiveList"data-v-4c658acc data-v-df2e5dde></ul></div></div><!----></div><div data-v-15f50eb8><a href="https://auth-routes.nuxtjs.org"class="button"target="_blank"data-v-15f50eb8><span data-v-15f50eb8><div class="icon eye"data-v-15f50eb8></div></span>Live Demo </a><a href="https://gomix.com/#!/project/nuxt-auth-routes"class="button"target="_blank"data-v-15f50eb8><span data-v-15f50eb8><div class="icon edit"data-v-15f50eb8></div></span>Live Edit </a><a href="https://minhaskamal.github.io/DownGit/#/home?url=https://github.com/nuxt/nuxt.js/tree/master/examples/auth-routes"class="button"target="_blank"data-v-15f50eb8><span data-v-15f50eb8><div class="icon download"data-v-15f50eb8></div></span>Download</a></div><div data-v-15f50eb8><h1 id="documentation">Documentation</h1><blockquote><p>Nuxt.js can be used to create authenticated routes easily.</blockquote><h2 id="using-express-and-sessions">Using Express and Sessions</h2><p>To add the sessions feature in our application, we will use <code>express</code> and <code>express-session</code>, for this, we need to use Nuxt.js programmatically.<p>First, we install the depedencies:<pre><code class="hljs bash">yarn add express express-session body-parser whatwg-fetch</code></pre><p><em>We will talk about <code>whatwg-fetch</code> later.</em><p>Then we create our <code>server.js</code>:<pre><code class="hljs js"><span class="hljs-keyword">const</span> Nuxt = <span class="hljs-built_in">require</span>(<span class="hljs-string">'nuxt'</span>)
<span class="hljs-keyword">const</span> bodyParser = <span class="hljs-built_in">require</span>(<span class="hljs-string">'body-parser'</span>)
<span class="hljs-keyword">const</span> session = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express-session'</span>)
<span class="hljs-keyword">const</span> app = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>)()

<span class="hljs-comment">// Body parser, to access req.body</span>
app.use(bodyParser.json())

<span class="hljs-comment">// Sessions to create req.session</span>
app.use(session({
  <span class="hljs-attr">secret</span>: <span class="hljs-string">'super-secret-key'</span>,
  <span class="hljs-attr">resave</span>: <span class="hljs-literal">false</span>,
  <span class="hljs-attr">saveUninitialized</span>: <span class="hljs-literal">false</span>,
  <span class="hljs-attr">cookie</span>: { <span class="hljs-attr">maxAge</span>: <span class="hljs-number">60000</span> }
}))

<span class="hljs-comment">// POST /api/login to log in the user and add him to the req.session.authUser</span>
app.post(<span class="hljs-string">'/api/login'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">req, res</span>) </span>{
  <span class="hljs-keyword">if</span> (req.body.username === <span class="hljs-string">'demo'</span> && req.body.password === <span class="hljs-string">'demo'</span>) {
    req.session.authUser = { <span class="hljs-attr">username</span>: <span class="hljs-string">'demo'</span> }
    <span class="hljs-keyword">return</span> res.json({ <span class="hljs-attr">username</span>: <span class="hljs-string">'demo'</span> })
  }
  res.status(<span class="hljs-number">401</span>).json({ <span class="hljs-attr">error</span>: <span class="hljs-string">'Bad credentials'</span> })
})

<span class="hljs-comment">// POST /api/logout to log out the user and remove it from the req.session</span>
app.post(<span class="hljs-string">'/api/logout'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">req, res</span>) </span>{
  <span class="hljs-keyword">delete</span> req.session.authUser
  res.json({ <span class="hljs-attr">ok</span>: <span class="hljs-literal">true</span> })
})

<span class="hljs-comment">// We instantiate Nuxt.js with the options</span>
<span class="hljs-keyword">const</span> isProd = process.env.NODE_ENV === <span class="hljs-string">'production'</span>
<span class="hljs-keyword">const</span> nuxt = <span class="hljs-keyword">new</span> Nuxt({ <span class="hljs-attr">dev</span>: !isProd })
<span class="hljs-comment">// No build in production</span>
<span class="hljs-keyword">const</span> promise = (isProd ? <span class="hljs-built_in">Promise</span>.resolve() : nuxt.build())
promise.then(<span class="hljs-function"><span class="hljs-params">()</span> =></span> {
  app.use(nuxt.render)
  app.listen(<span class="hljs-number">3000</span>)
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Server is listening on http://localhost:3000'</span>)
})
.catch(<span class="hljs-function">(<span class="hljs-params">error</span>) =></span> {
  <span class="hljs-built_in">console</span>.error(error)
  process.exit(<span class="hljs-number">1</span>)
})</code></pre><p>And we update our <code>package.json</code> scripts:<pre><code class="hljs json">// ...
"scripts": {
  "dev": "node server.js",
  "build": "nuxt build",
  "start": "NODE_ENV=production node server.js"
}
// ...</code></pre><h2 id="using-the-store">Using the store</h2><p>We need a global state to let our application if the user is connected <strong>across the pages</strong>.<p>To let Nuxt.js use Vuex, we create a <code>store/index.js</code> file:<pre><code class="hljs js"><span class="hljs-keyword">import</span> Vue <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> Vuex <span class="hljs-keyword">from</span> <span class="hljs-string">'vuex'</span>

Vue.use(Vuex)

<span class="hljs-comment">// Polyfill for window.fetch()</span>
<span class="hljs-built_in">require</span>(<span class="hljs-string">'whatwg-fetch'</span>)

<span class="hljs-keyword">const</span> store = <span class="hljs-keyword">new</span> Vuex.Store({

  <span class="hljs-attr">state</span>: {
    <span class="hljs-attr">authUser</span>: <span class="hljs-literal">null</span>
  },

  <span class="hljs-attr">mutations</span>: {
    <span class="hljs-attr">SET_USER</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">state, user</span>) </span>{
      state.authUser = user
    }
  },

  <span class="hljs-attr">actions</span>: {
    <span class="hljs-comment">// ...</span>
  }

})

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> store</code></pre><ol><li>We import <code>Vue</code> and <code>Vuex</code> (included in Nuxt.js) and we tell Vue to use Vuex to let us use <code>$store</code> in our components<li>We <code>require('whatwg-fetch')</code> to polyfill the <code>fetch()</code> method across all browsers (see <a href="https://github.com/github/fetch">fetch repo</a>)<li>We create our <code>SET_USER</code> mutation which will set the <code>state.authUser</code> to the conntected user<li>We export our store instance to Nuxt.js can inject it to our main application</ol><h3 id="nuxtserverinit-action">nuxtServerInit() action</h3><p>Nuxt.js will call a specific action called <code>nuxtServerInit</code> with the context in argument, so when the app will be loaded, the store will be already filled with some data we can get from the server.<p>In our <code>store/index.js</code>, we can add the <code>nuxtServerInit</code> action:<pre><code class="hljs js">nuxtServerInit ({ commit }, { req }) {
  <span class="hljs-keyword">if</span> (req.session && req.session.authUser) {
    commit(<span class="hljs-string">'SET_USER'</span>, req.session.authUser)
  }
}</code></pre><h3 id="login-action">login() action</h3><p>We add a <code>login</code> action which will be called from our pages component to log in the user:<pre><code class="hljs js">login ({ commit }, { username, password }) {
  <span class="hljs-keyword">return</span> fetch(<span class="hljs-string">'/api/login'</span>, {
    <span class="hljs-comment">// Send the client cookies to the server</span>
    credentials: <span class="hljs-string">'same-origin'</span>,
    <span class="hljs-attr">method</span>: <span class="hljs-string">'POST'</span>,
    <span class="hljs-attr">headers</span>: {
      <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/json'</span>
    },
    <span class="hljs-attr">body</span>: <span class="hljs-built_in">JSON</span>.stringify({
      username,
      password
    })
  })
  .then(<span class="hljs-function">(<span class="hljs-params">res</span>) =></span> {
    <span class="hljs-keyword">if</span> (res.status === <span class="hljs-number">401</span>) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'Bad credentials'</span>)
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">return</span> res.json()
    }
  })
  .then(<span class="hljs-function">(<span class="hljs-params">authUser</span>) =></span> {
    commit(<span class="hljs-string">'SET_USER'</span>, authUser)
  })
}</code></pre><h3 id="logout-method">logout() method</h3><pre><code class="hljs js">logout ({ commit }) {
  <span class="hljs-keyword">return</span> fetch(<span class="hljs-string">'/api/logout'</span>, {
    <span class="hljs-comment">// Send the client cookies to the server</span>
    credentials: <span class="hljs-string">'same-origin'</span>,
    <span class="hljs-attr">method</span>: <span class="hljs-string">'POST'</span>
  })
  .then(<span class="hljs-function"><span class="hljs-params">()</span> =></span> {
    commit(<span class="hljs-string">'SET_USER'</span>, <span class="hljs-literal">null</span>)
  })
}</code></pre><h2 id="pages-components">Pages components</h2><p>Then we can use <code>$store.state.authUser</code> in our pages components to check if the user is connected in our application or not.<h3 id="redirect-user-if-not-connected">Redirect user if not connected</h3><p>Let's add a <code>/secret</code> route where only the connected user can see its content:<pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>></span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>></span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>></span>Super secret page<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>></span>
    <span class="hljs-tag">&lt;<span class="hljs-name">router-link</span> <span class="hljs-attr">to</span>=<span class="hljs-string">"/"</span>></span>Back to the home page<span class="hljs-tag">&lt;/<span class="hljs-name">router-link</span>></span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>></span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>></span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span>></span><span class="javascript">
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-comment">// we use fetch() because we do not need to set data to this component</span>
  fetch ({ store, redirect }) {
    <span class="hljs-keyword">if</span> (!store.state.authUser) {
      <span class="hljs-keyword">return</span> redirect(<span class="hljs-string">'/'</span>)
    }
  }
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>></span></code></pre><p>We can see in the <code>fetch</code> method that we call <code>redirect('/')</code> when our user is not connected.</div></div></div><div class="category__footer"><footer class="Footer"data-v-4e99f6ef><div class="container Footer__Author"data-v-4e99f6ef>Made by Chopin Brothers: <a href="https://github.com/Atinux"target="_blank"data-v-4e99f6ef>@Atinux</a> & <a href="https://github.com/alexchopin"target="_blank"data-v-4e99f6ef>@alexchopin</a></div></footer></div></div><!----></div></div></div></div><script defer>window.__NUXT__={data:[null,{attrs:{title:"Auth Routes",description:"Authenticated routes example with Nuxt.js",github:"auth-routes",livedemo:"https://auth-routes.nuxtjs.org",liveedit:"https://gomix.com/#!/project/nuxt-auth-routes"},body:'<h1 id="documentation">Documentation</h1>\n<blockquote>\n<p>Nuxt.js can be used to create authenticated routes easily.</p>\n</blockquote>\n<h2 id="using-express-and-sessions">Using Express and Sessions</h2>\n<p>To add the sessions feature in our application, we will use <code>express</code> and <code>express-session</code>, for this, we need to use Nuxt.js programmatically.</p>\n<p>First, we install the depedencies:</p>\n<pre><code class="hljs bash">yarn add express express-session body-parser whatwg-fetch</code></pre><p><em>We will talk about <code>whatwg-fetch</code> later.</em></p>\n<p>Then we create our <code>server.js</code>:</p>\n<pre><code class="hljs js"><span class="hljs-keyword">const</span> Nuxt = <span class="hljs-built_in">require</span>(<span class="hljs-string">\'nuxt\'</span>)\n<span class="hljs-keyword">const</span> bodyParser = <span class="hljs-built_in">require</span>(<span class="hljs-string">\'body-parser\'</span>)\n<span class="hljs-keyword">const</span> session = <span class="hljs-built_in">require</span>(<span class="hljs-string">\'express-session\'</span>)\n<span class="hljs-keyword">const</span> app = <span class="hljs-built_in">require</span>(<span class="hljs-string">\'express\'</span>)()\n\n<span class="hljs-comment">// Body parser, to access req.body</span>\napp.use(bodyParser.json())\n\n<span class="hljs-comment">// Sessions to create req.session</span>\napp.use(session({\n  <span class="hljs-attr">secret</span>: <span class="hljs-string">\'super-secret-key\'</span>,\n  <span class="hljs-attr">resave</span>: <span class="hljs-literal">false</span>,\n  <span class="hljs-attr">saveUninitialized</span>: <span class="hljs-literal">false</span>,\n  <span class="hljs-attr">cookie</span>: { <span class="hljs-attr">maxAge</span>: <span class="hljs-number">60000</span> }\n}))\n\n<span class="hljs-comment">// POST /api/login to log in the user and add him to the req.session.authUser</span>\napp.post(<span class="hljs-string">\'/api/login\'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">req, res</span>) </span>{\n  <span class="hljs-keyword">if</span> (req.body.username === <span class="hljs-string">\'demo\'</span> &amp;&amp; req.body.password === <span class="hljs-string">\'demo\'</span>) {\n    req.session.authUser = { <span class="hljs-attr">username</span>: <span class="hljs-string">\'demo\'</span> }\n    <span class="hljs-keyword">return</span> res.json({ <span class="hljs-attr">username</span>: <span class="hljs-string">\'demo\'</span> })\n  }\n  res.status(<span class="hljs-number">401</span>).json({ <span class="hljs-attr">error</span>: <span class="hljs-string">\'Bad credentials\'</span> })\n})\n\n<span class="hljs-comment">// POST /api/logout to log out the user and remove it from the req.session</span>\napp.post(<span class="hljs-string">\'/api/logout\'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">req, res</span>) </span>{\n  <span class="hljs-keyword">delete</span> req.session.authUser\n  res.json({ <span class="hljs-attr">ok</span>: <span class="hljs-literal">true</span> })\n})\n\n<span class="hljs-comment">// We instantiate Nuxt.js with the options</span>\n<span class="hljs-keyword">const</span> isProd = process.env.NODE_ENV === <span class="hljs-string">\'production\'</span>\n<span class="hljs-keyword">const</span> nuxt = <span class="hljs-keyword">new</span> Nuxt({ <span class="hljs-attr">dev</span>: !isProd })\n<span class="hljs-comment">// No build in production</span>\n<span class="hljs-keyword">const</span> promise = (isProd ? <span class="hljs-built_in">Promise</span>.resolve() : nuxt.build())\npromise.then(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {\n  app.use(nuxt.render)\n  app.listen(<span class="hljs-number">3000</span>)\n  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">\'Server is listening on http://localhost:3000\'</span>)\n})\n.catch(<span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> {\n  <span class="hljs-built_in">console</span>.error(error)\n  process.exit(<span class="hljs-number">1</span>)\n})</code></pre><p>And we update our <code>package.json</code> scripts:</p>\n<pre><code class="hljs json">// ...\n"scripts": {\n  "dev": "node server.js",\n  "build": "nuxt build",\n  "start": "NODE_ENV=production node server.js"\n}\n// ...</code></pre><h2 id="using-the-store">Using the store</h2>\n<p>We need a global state to let our application if the user is connected <strong>across the pages</strong>.</p>\n<p>To let Nuxt.js use Vuex, we create a <code>store/index.js</code> file:</p>\n<pre><code class="hljs js"><span class="hljs-keyword">import</span> Vue <span class="hljs-keyword">from</span> <span class="hljs-string">\'vue\'</span>\n<span class="hljs-keyword">import</span> Vuex <span class="hljs-keyword">from</span> <span class="hljs-string">\'vuex\'</span>\n\nVue.use(Vuex)\n\n<span class="hljs-comment">// Polyfill for window.fetch()</span>\n<span class="hljs-built_in">require</span>(<span class="hljs-string">\'whatwg-fetch\'</span>)\n\n<span class="hljs-keyword">const</span> store = <span class="hljs-keyword">new</span> Vuex.Store({\n\n  <span class="hljs-attr">state</span>: {\n    <span class="hljs-attr">authUser</span>: <span class="hljs-literal">null</span>\n  },\n\n  <span class="hljs-attr">mutations</span>: {\n    <span class="hljs-attr">SET_USER</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">state, user</span>) </span>{\n      state.authUser = user\n    }\n  },\n\n  <span class="hljs-attr">actions</span>: {\n    <span class="hljs-comment">// ...</span>\n  }\n\n})\n\n<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> store</code></pre><ol>\n<li>We import <code>Vue</code> and <code>Vuex</code> (included in Nuxt.js) and we tell Vue to use Vuex to let us use <code>$store</code> in our components</li>\n<li>We <code>require(&#39;whatwg-fetch&#39;)</code> to polyfill the <code>fetch()</code> method across all browsers (see <a href="https://github.com/github/fetch">fetch repo</a>)</li>\n<li>We create our <code>SET_USER</code> mutation which will set the <code>state.authUser</code> to the conntected user</li>\n<li>We export our store instance to Nuxt.js can inject it to our main application</li>\n</ol>\n<h3 id="nuxtserverinit-action">nuxtServerInit() action</h3>\n<p>Nuxt.js will call a specific action called <code>nuxtServerInit</code> with the context in argument, so when the app will be loaded, the store will be already filled with some data we can get from the server.</p>\n<p>In our <code>store/index.js</code>, we can add the <code>nuxtServerInit</code> action:</p>\n<pre><code class="hljs js">nuxtServerInit ({ commit }, { req }) {\n  <span class="hljs-keyword">if</span> (req.session &amp;&amp; req.session.authUser) {\n    commit(<span class="hljs-string">\'SET_USER\'</span>, req.session.authUser)\n  }\n}</code></pre><h3 id="login-action">login() action</h3>\n<p>We add a <code>login</code> action which will be called from our pages component to log in the user:</p>\n<pre><code class="hljs js">login ({ commit }, { username, password }) {\n  <span class="hljs-keyword">return</span> fetch(<span class="hljs-string">\'/api/login\'</span>, {\n    <span class="hljs-comment">// Send the client cookies to the server</span>\n    credentials: <span class="hljs-string">\'same-origin\'</span>,\n    <span class="hljs-attr">method</span>: <span class="hljs-string">\'POST\'</span>,\n    <span class="hljs-attr">headers</span>: {\n      <span class="hljs-string">\'Content-Type\'</span>: <span class="hljs-string">\'application/json\'</span>\n    },\n    <span class="hljs-attr">body</span>: <span class="hljs-built_in">JSON</span>.stringify({\n      username,\n      password\n    })\n  })\n  .then(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> {\n    <span class="hljs-keyword">if</span> (res.status === <span class="hljs-number">401</span>) {\n      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">\'Bad credentials\'</span>)\n    } <span class="hljs-keyword">else</span> {\n      <span class="hljs-keyword">return</span> res.json()\n    }\n  })\n  .then(<span class="hljs-function">(<span class="hljs-params">authUser</span>) =&gt;</span> {\n    commit(<span class="hljs-string">\'SET_USER\'</span>, authUser)\n  })\n}</code></pre><h3 id="logout-method">logout() method</h3>\n<pre><code class="hljs js">logout ({ commit }) {\n  <span class="hljs-keyword">return</span> fetch(<span class="hljs-string">\'/api/logout\'</span>, {\n    <span class="hljs-comment">// Send the client cookies to the server</span>\n    credentials: <span class="hljs-string">\'same-origin\'</span>,\n    <span class="hljs-attr">method</span>: <span class="hljs-string">\'POST\'</span>\n  })\n  .then(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {\n    commit(<span class="hljs-string">\'SET_USER\'</span>, <span class="hljs-literal">null</span>)\n  })\n}</code></pre><h2 id="pages-components">Pages components</h2>\n<p>Then we can use <code>$store.state.authUser</code> in our pages components to check if the user is connected in our application or not.</p>\n<h3 id="redirect-user-if-not-connected">Redirect user if not connected</h3>\n<p>Let&#39;s add a <code>/secret</code> route where only the connected user can see its content:</p>\n<pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>\n  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>\n    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Super secret page<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>\n    <span class="hljs-tag">&lt;<span class="hljs-name">router-link</span> <span class="hljs-attr">to</span>=<span class="hljs-string">"/"</span>&gt;</span>Back to the home page<span class="hljs-tag">&lt;/<span class="hljs-name">router-link</span>&gt;</span>\n  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>\n<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>\n\n<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">\n<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {\n  <span class="hljs-comment">// we use fetch() because we do not need to set data to this component</span>\n  fetch ({ store, redirect }) {\n    <span class="hljs-keyword">if</span> (!store.state.authUser) {\n      <span class="hljs-keyword">return</span> redirect(<span class="hljs-string">\'/\'</span>)\n    }\n  }\n}\n</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></code></pre><p>We can see in the <code>fetch</code> method that we call <code>redirect(&#39;/&#39;)</code> when our user is not connected.</p>\n'}],error:null,state:{version:"0.9.5",visibleHeader:!1,visibleAffix:!1,apiURI:"https://docs.api.nuxtjs.org",lang:{iso:"en",links:{api:"API",blog:"Blog",chat:"Chat",download:"Download",examples:"Examples",ecosystem:"Ecosystem",get_started:"get started",github:"Github",guide:"Guide",homepage:"Home page",live_demo:"Live Demo",live_edit:"Live Edit",twitter:"Twitter",vuejs:"Vue.js",vue_jobs:"Vue Jobs"},homepage:{title:"Universal Vue.js Applications"},footer:{authors:"Made by Chopin Brothers"},guide:{release_notes:"Release Notes"},examples:{source_code:"Source Code"}},menu:{api:[{title:"Nuxt Module",links:[{name:"Usage",to:""},{name:"Render",to:"/nuxt-render"},{name:"RenderRoute",to:"/nuxt-render-route"},{name:"RenderAndGetWindow",to:"/nuxt-render-and-get-window"}]},{title:"Configuration",links:[{name:"Build",to:"/configuration-build"},{name:"Cache",to:"/configuration-cache"},{name:"CSS",to:"/configuration-css"},{name:"Env",to:"/configuration-env"},{name:"Generate",to:"/configuration-generate"},{name:"Head",to:"/configuration-head"},{name:"Loading",to:"/configuration-loading"},{name:"Plugins",to:"/configuration-plugins"},{name:"Router",to:"/configuration-router"}]},{title:"Pages",links:[{name:"Context",to:"/pages-context"}]}],examples:[{title:"Essentials",links:[{name:"Hello world",to:""},{name:"SEO HTML Head",to:"/seo-html-head"}]},{title:"Customization",links:[{name:"Cached Components",to:"/cached-components"},{name:"Custom Loading",to:"/custom-loading"},{name:"Custom Routes",to:"/custom-routes"},{name:"Global CSS",to:"/global-css"},{name:"Layouts",to:"/layouts"},{name:"Plugins",to:"/plugins"},{name:"Routes transitions",to:"/routes-transitions"}]},{title:"Advanced",links:[{name:"Async Datas",to:"/async-datas"},{name:"Auth Routes",to:"/auth-routes"},{name:"Vuex Store",to:"/vuex-store"},{name:"Testing",to:"/testing"}]}],guide:[{title:"Getting Started",links:[{name:"Introduction",to:"",contents:[{name:"What is Nuxt.js ?",to:"#what-is-nuxt-js-"},{name:"How it Works",to:"#how-it-works"},{name:"Features",to:"#features"},{name:"Server Rendered",to:"#server-rendered"},{name:"Static Generated",to:"#static-generated"}]},{name:"Installation",to:"/installation",contents:[{name:"Using Nuxt.js starter template",to:"#using-nuxt-js-starter-template"},{name:"Starting from scratch",to:"#starting-from-scratch"}]},{name:"Directory structure",to:"/directory-structure",contents:[{name:"Directories",to:"#directories"},{name:"Aliases",to:"#aliases"}]},{name:"Configuration",to:"/configuration"},{name:"Commands",to:"/commands",contents:[{name:"List of Commands",to:"#list-of-commands"},{name:"Production Deployment",to:"#production-deployment"},{name:"Static Hosting Deployment",to:"#static-hosting-deployment"}]}]},{title:"Router",links:[{name:"Basic Routes",to:"/basic-routes"},{name:"Dynamic Routes",to:"/dynamic-routes",contents:[{name:"Directory Structure",to:"#directory-structure"},{name:"Validate Route Params",to:"#validate-route-params"}]},{name:"Nested Routes",to:"/nested-routes",contents:[{name:"Directory Structure",to:"#directory-structure"},{name:"Dynamic Nested Routes",to:"#dynamic-nested-routes"}]},{name:"Transitions",to:"/routes-transitions",contents:[{name:"Usage",to:"#usage"},{name:"The transition Key",to:"#the-transition-key"},{name:"Transition for a Specific Page",to:"#transition-for-a-specific-page"},{name:"Dynamic Transition",to:"#dynamic-transition"}]},{name:"Middleware",to:"/routes-middleware"}]},{title:"Views",links:[{name:"Pages",to:"/pages",contents:[{name:"Special Keys",to:"#special-keys"},{name:"A Simple Page",to:"#a-simple-page"},{name:"Using Pre-Processors",to:"#using-pre-processors"},{name:"Using JSX",to:"#using-jsx"}]},{name:"Layouts",to:"/layouts",contents:[{name:"Default Layout",to:"#default-layout"},{name:"Error Page",to:"#error-page"},{name:"Custom Layout",to:"#custom-layout"}]},{name:"Custom Loading",to:"/custom-loading",contents:[{name:"Disable the Progress Bar",to:"#disable-the-progress-bar"},{name:"Customize the Progress Bar",to:"#customize-the-progress-bar"},{name:"Use a Custom Loading Component",to:"#use-a-custom-loading-component"}]},{name:"HTML Head",to:"/html-head",contents:[{name:"Title",to:"#title"},{name:"Meta Tags",to:"#meta-tags"},{name:"Using Page Data",to:"#using-page-data"},{name:"Defaults Meta",to:"#defaults-meta"}]}]},{title:"Data",links:[{name:"Async data",to:"/async-data",contents:[{name:"The data Method",to:"#the-data-method"},{name:"The Context",to:"#the-context"},{name:"Handling Errors",to:"#handling-errors"}]},{name:"Vuex store",to:"/vuex-store",contents:[{name:"Activate the Store",to:"#activate-the-store"},{name:"Modules Files",to:"#modules-files"},{name:"The fetch Method",to:"#the-fetch-method"},{name:"The Context",to:"#the-context"},{name:"The nuxtServerInit Action",to:"#the-nuxtserverinit-action"}]}]},{title:"Resources",links:[{name:"Assets",to:"/assets"},{name:"Static",to:"/static"},{name:"Plugins",to:"/plugins",contents:[{name:"Use External Modules",to:"#use-external-modules"},{name:"Use Vue Plugins",to:"#use-vue-plugins"},{name:"Only for Browsers",to:"#only-for-browsers"}]}]},{title:"Dev Tools",links:[{name:"ESLint",to:"/eslint"},{name:"Unit Testing",to:"/unit-testing"}]},{title:"Miscellaneous",links:[{name:"Contribution Guide",to:"/contribution-guide"},{name:"Release Notes",to:"/release-notes"}]}]}},serverRendered:!0}</script><script defer src="/_nuxt/vendor.bundle.js"></script><script defer src="/_nuxt/nuxt.bundle.js"></script>